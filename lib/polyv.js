var polyvVodPlayer={version:"v1.0.1",buidMetaData:20180717,jsonHost:"https://router.polyv.net/secure/",isPreviewMode:false,isWx:false,token:"",seed:0,state:"end",timeStamp:0,time:0,currentTime:0,detailTime:0,videoId:"",pid:"",uid:"",flow:0,pd:0,sd:0,cts:0,duration:0,pn:"",pv:"",sign:"",sessionId:"",param1:"",param2:"",param3:"",param4:"",param5:"",getVideo:function(e){this.loadJson(e)},getPreviewVideo:function(e){this.isPreviewMode=true;this.loadJson(e)},loadJson:function(e){var r=this.version;var t={version:r,timeoutflow:false,outflow:false};if(e.vid==""){t={version:r,error:"vid不能为空"};e.callback(t);return}var a=(new Date).getTime();var i=Math.floor(Math.random()*1e6+1e6);var n=a+"X"+i;var s=e.vid.substr(0,10);var o=this;o.videoId=e.vid;o.ts=e.ts;o.sign=e.sign;o.uid=s;o.pid=n;o.version=t.version;if(e.params){if(e.params.param1){o.param1=e.params.param1}if(e.params.param2){o.param2=e.params.param2}if(e.params.param3){o.param3=e.params.param3}if(e.params.param4){o.param4=e.params.param4}if(e.params.param5){o.param5=e.params.param5}}if(e.sid){o.sessionId=e.sid}wx.request({url:o.jsonHost+e.vid+".js",method:"GET",success:function(r){if(r.data.timeoutflow=="true"){t.timeoutflow=true}else if(r.data.outflow=="true"){t.outflow=true}else{t.poster=r.data.first_image;t.title=r.data.title;t.teaser_url=r.data.teaser_url;t.catatree=r.data.catatree;t.adMatter=r.data.adMatter;t.ratio=r.data.ratio;t.duration=r.data.duration;t.poster=o.proxy(t.poster);t.teaser_url=o.proxy(t.teaser_url);t.adMatter=o.proxy(t.adMatter,"matterurl");o.seed=r.data.seed;if(r.data.seed==1){t.src=o.proxy(r.data.hls)}else{t.src=o.proxy(r.data.mp4)}o.duration=r.data.duration}if(o.seed===1&&e.wxApp&&e.wxApp.isWx){o.isWx=true;o.getWxToken(e,function(a){o.token=a;for(var i=0;i<r.data.hls.length;i++){if(e.hlstest){t.src[i]=o.resetUrl(r.data.hls[i]).replace("hls.","hlstest.")}else{t.src[i]=o.resetUrl(r.data.hls[i])}}e.callback(t)},function(){t={error:"播放token获取失败"};e.callback(t)})}else{e.callback(t)}if(o.countInterval){clearInterval(o.countInterval)}o.countInterval=setInterval(function(){o.countWholeTime()},1e3)},fail:function(r){t={error:"视频数据获取失败"};e.callback(t)}})},getWxToken:function(e,r){var t=e.wxApp.wxAppUrl;var a=(new Date).getTime();var i=CModule.ccall("getsign","string",["string","string","string"],[e.wxApp.wxUserId,e.vid,a.toString()]);var n=e.wxApp;n.iswxa=1;n.vid=e.vid;n.ts=a;n.sign=i;wx.request({url:t,method:"GET",data:n,success:function(e){var t=CModule.ccall("loadtoken","string",["string"],[e.data]);r(JSON.parse(t).data.token)},fail:function(){}})},timeUpdate:function(e){if(e&&e.detail&&e.detail.currentTime){this.detailTime=e.detail.currentTime}},updateState:function(){if(this.currentTime==this.detailTime){this.state="end"}else{this.state="played";this.currentTime=this.detailTime}},countWholeTime:function(){var e=this;var r=(new Date).getTime();e.updateState();if(this.state=="played"){e.time+=1}if(r-e.timeStamp>9*1e3){e.timeStamp=r;e.sendState()}},sendState:function(){var e=this;var r=0;var t=0;t=Math.floor(this.currentTime);r=e.time;if(r>0&&e.state=="played"){var a=(new Date).getTime();var i="rtas.net"+e.pid+e.videoId+e.flow+r+t;var n=MD5(i);var s=e.sessionId;if(e.param1||e.param2||e.param3||e.param4||e.param5){var o={pid:e.pid,uid:e.uid,vid:e.videoId,flow:0,pd:r,sd:r,cts:t,duration:e.duration,pn:"webapp_vod",pv:e.version,sign:n,sid:s,param1:e.param1,param2:e.param2,param3:e.param3,param4:e.param4,param5:e.param5}}else if(s){var o={pid:e.pid,uid:e.uid,vid:e.videoId,flow:0,pd:r,sd:r,cts:t,duration:e.duration,pn:"webapp_vod",pv:e.version,sign:n,sid:s}}else{var o={pid:e.pid,uid:e.uid,vid:e.videoId,flow:0,pd:r,sd:r,cts:t,duration:e.duration,pn:"webapp_vod",pv:e.version,sign:n}}wx.request({url:"https://prtas.videocc.net/v1/view",data:o})}},proxy:function(e,r){var t=this;if(typeof e=="undefined"||e.length==0){return""}if(typeof e=="string"){e=this.resetUrl(e);return this.proxyUrl(e)}else{if(arguments[1]){for(var a=0,i=e.length;a<i;a++){for(var n in e[a]){if(n==r){e[a][n]=this.proxyUrl(e[a][n])}}}}else{for(var a=0,i=e.length;a<i;a++){if(this.isPreviewMode){var s=this.videoId.substring(0,32);e[a]=e[a].replace(s,"p_"+s)}if(t.ts&&t.sign){if(e[a].indexOf("?")>-1){e[a]=e[a]+"&ts="+t.ts+"&sign="+t.sign}else{e[a]=e[a]+"?ts="+t.ts+"&sign="+t.sign}}e[a]=this.proxyUrl(e[a])}}return e}return""},proxyUrl:function(e){if(e==""){return e}e=e.replace(/.*?:\/\//g,"");return"https://router.polyv.net/proxy/"+e},resetUrl:function(e){var r=this;if(this.isPreviewMode&&r.seed==1){var t=this.videoId.substring(0,32);e=e.replace(t,"p_"+t)}if(r.ts&&r.sign){if(e.indexOf("?")>-1){e=e+"&ts="+r.ts+"&sign="+r.sign}else{e=e+"?ts="+r.ts+"&sign="+r.sign}}if(r.isWx){if(e.indexOf("?")>-1){e=e+"&token="+r.token+"&iswxa=1"+"&pid="+r.pid}else{e=e+"?token="+r.token+"&iswxa=1"+"&pid="+r.pid}}return e}};var MD5=function(e){function r(e,r){return e<<r|e>>>32-r}function t(e,r){var t,a,i,n,s;i=e&2147483648;n=r&2147483648;t=e&1073741824;a=r&1073741824;s=(e&1073741823)+(r&1073741823);if(t&a){return s^2147483648^i^n}if(t|a){if(s&1073741824){return s^3221225472^i^n}else{return s^1073741824^i^n}}else{return s^i^n}}function a(e,r,t){return e&r|~e&t}function i(e,r,t){return e&t|r&~t}function n(e,r,t){return e^r^t}function s(e,r,t){return r^(e|~t)}function o(e,i,n,s,o,d,p){e=t(e,t(t(a(i,n,s),o),p));return t(r(e,d),i)}function d(e,a,n,s,o,d,p){e=t(e,t(t(i(a,n,s),o),p));return t(r(e,d),a)}function p(e,a,i,s,o,d,p){e=t(e,t(t(n(a,i,s),o),p));return t(r(e,d),a)}function u(e,a,i,n,o,d,p){e=t(e,t(t(s(a,i,n),o),p));return t(r(e,d),a)}function l(e){var r;var t=e.length;var a=t+8;var i=(a-a%64)/64;var n=(i+1)*16;var s=Array(n-1);var o=0;var d=0;while(d<t){r=(d-d%4)/4;o=d%4*8;s[r]=s[r]|e.charCodeAt(d)<<o;d++}r=(d-d%4)/4;o=d%4*8;s[r]=s[r]|128<<o;s[n-2]=t<<3;s[n-1]=t>>>29;return s}function v(e){var r="",t="",a,i;for(i=0;i<=3;i++){a=e>>>i*8&255;t="0"+a.toString(16);r=r+t.substr(t.length-2,2)}return r}function f(e){e=e.replace(/\r\n/g,"\n");var r="";for(var t=0;t<e.length;t++){var a=e.charCodeAt(t);if(a<128){r+=String.fromCharCode(a)}else if(a>127&&a<2048){r+=String.fromCharCode(a>>6|192);r+=String.fromCharCode(a&63|128)}else{r+=String.fromCharCode(a>>12|224);r+=String.fromCharCode(a>>6&63|128);r+=String.fromCharCode(a&63|128)}}return r}var m=Array();var c,g,h,w,x,y,T,C,I;var V=7,k=12,M=17,S=22;var U=5,b=9,P=14,A=20;var _=4,W=11,D=16,j=23;var q=6,J=10,O=15,E=21;e=f(e);m=l(e);y=1732584193;T=4023233417;C=2562383102;I=271733878;for(c=0;c<m.length;c+=16){g=y;h=T;w=C;x=I;y=o(y,T,C,I,m[c+0],V,3614090360);I=o(I,y,T,C,m[c+1],k,3905402710);C=o(C,I,y,T,m[c+2],M,606105819);T=o(T,C,I,y,m[c+3],S,3250441966);y=o(y,T,C,I,m[c+4],V,4118548399);I=o(I,y,T,C,m[c+5],k,1200080426);C=o(C,I,y,T,m[c+6],M,2821735955);T=o(T,C,I,y,m[c+7],S,4249261313);y=o(y,T,C,I,m[c+8],V,1770035416);I=o(I,y,T,C,m[c+9],k,2336552879);C=o(C,I,y,T,m[c+10],M,4294925233);T=o(T,C,I,y,m[c+11],S,2304563134);y=o(y,T,C,I,m[c+12],V,1804603682);I=o(I,y,T,C,m[c+13],k,4254626195);C=o(C,I,y,T,m[c+14],M,2792965006);T=o(T,C,I,y,m[c+15],S,1236535329);y=d(y,T,C,I,m[c+1],U,4129170786);I=d(I,y,T,C,m[c+6],b,3225465664);C=d(C,I,y,T,m[c+11],P,643717713);T=d(T,C,I,y,m[c+0],A,3921069994);y=d(y,T,C,I,m[c+5],U,3593408605);I=d(I,y,T,C,m[c+10],b,38016083);C=d(C,I,y,T,m[c+15],P,3634488961);T=d(T,C,I,y,m[c+4],A,3889429448);y=d(y,T,C,I,m[c+9],U,568446438);I=d(I,y,T,C,m[c+14],b,3275163606);C=d(C,I,y,T,m[c+3],P,4107603335);T=d(T,C,I,y,m[c+8],A,1163531501);y=d(y,T,C,I,m[c+13],U,2850285829);I=d(I,y,T,C,m[c+2],b,4243563512);C=d(C,I,y,T,m[c+7],P,1735328473);T=d(T,C,I,y,m[c+12],A,2368359562);y=p(y,T,C,I,m[c+5],_,4294588738);I=p(I,y,T,C,m[c+8],W,2272392833);C=p(C,I,y,T,m[c+11],D,1839030562);T=p(T,C,I,y,m[c+14],j,4259657740);y=p(y,T,C,I,m[c+1],_,2763975236);I=p(I,y,T,C,m[c+4],W,1272893353);C=p(C,I,y,T,m[c+7],D,4139469664);T=p(T,C,I,y,m[c+10],j,3200236656);y=p(y,T,C,I,m[c+13],_,681279174);I=p(I,y,T,C,m[c+0],W,3936430074);C=p(C,I,y,T,m[c+3],D,3572445317);T=p(T,C,I,y,m[c+6],j,76029189);y=p(y,T,C,I,m[c+9],_,3654602809);I=p(I,y,T,C,m[c+12],W,3873151461);C=p(C,I,y,T,m[c+15],D,530742520);T=p(T,C,I,y,m[c+2],j,3299628645);y=u(y,T,C,I,m[c+0],q,4096336452);I=u(I,y,T,C,m[c+7],J,1126891415);C=u(C,I,y,T,m[c+14],O,2878612391);T=u(T,C,I,y,m[c+5],E,4237533241);y=u(y,T,C,I,m[c+12],q,1700485571);I=u(I,y,T,C,m[c+3],J,2399980690);C=u(C,I,y,T,m[c+10],O,4293915773);T=u(T,C,I,y,m[c+1],E,2240044497);y=u(y,T,C,I,m[c+8],q,1873313359);I=u(I,y,T,C,m[c+15],J,4264355552);C=u(C,I,y,T,m[c+6],O,2734768916);T=u(T,C,I,y,m[c+13],E,1309151649);y=u(y,T,C,I,m[c+4],q,4149444226);I=u(I,y,T,C,m[c+11],J,3174756917);C=u(C,I,y,T,m[c+2],O,718787259);T=u(T,C,I,y,m[c+9],E,3951481745);y=t(y,g);T=t(T,h);C=t(C,w);I=t(I,x)}var G=v(y)+v(T)+v(C)+v(I);return G.toLowerCase()};function getVideo(e){polyvVodPlayer.getVideo(e)}function getPreviewVideo(e){polyvVodPlayer.getPreviewVideo(e)}function timeUpdate(e){polyvVodPlayer.timeUpdate(e)}function getVersion(){return polyvVodPlayer.version}module.exports={getVideo:getVideo,getPreviewVideo:getPreviewVideo,timeUpdate:timeUpdate,version:getVersion};